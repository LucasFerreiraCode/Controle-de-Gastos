<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Controle de Gastos</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 2rem;
            max-width: 800px;
            margin: auto;
            background: linear-gradient(to right, #3b82f6, #60a5fa);
            color: #ffffff;
        }

        h1,
        h2 {
            text-align: center;
        }

        .flex-container {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        .input-group,
        .meta-group {
            background-color: #1e40af;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        input,
        select,
        button {
            padding: 0.75rem;
            font-size: 16px;
            border-radius: 6px;
        }

        input,
        select {
            border: 1px solid #d1d5db;
        }

        button {
            background-color: #10b981;
            color: white;
            border: none;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s;
        }

        button:hover {
            background-color: #059669;
            transform: scale(1.05);
        }

        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2563eb;
            color: white;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background-color: white;
            color: #1f2937;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .remove-btn {
            background-color: #ef4444;
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .total,
        .goal-display {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-top: 1rem;
        }
    </style>
</head>

<body>
    <h1>Controle de Gastos</h1>

    <div class="flex-container">
        <div class="meta-group">
            <input id="goal" type="number" placeholder="Meta de economia (R$)" />
            <input id="income" type="number" placeholder="Ganhos totais (R$)" />
            <button onclick="updateMeta()">Atualizar Metas</button>
        </div>

        <div class="input-group">
            <input id="description" type="text" placeholder="Descrição" />
            <input id="amount" type="number" placeholder="Valor do Gasto" />
            <select id="category">
                <option value="Compras para casa">Compras para casa</option>
                <option value="Cosméticos">Cosméticos</option>
                <option value='"Pizza, lanches, doces"'>"Pizza, lanches, doces"</option>
                <option value="Contas">Contas</option>
                <option value="Outros">Outros</option>
            </select>
            <button onclick="addExpense()">Adicionar Gasto</button>
        </div>
    </div>

    <h2>Lista de Gastos</h2>
    <table id="expense-table">
        <thead>
            <tr>
                <th>Descrição</th>
                <th>Valor</th>
                <th>Categoria</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="total" id="total-display">Total de Gastos: R$ 0,00</div>
    <div class="goal-display" id="goal-display">Meta: R$ 0,00 | Ganhos: R$ 0,00 | Poupança Esperada: R$ 0,00</div>
    <div class="total" id="monthly-summary">Resumo Mensal: </div>

    <canvas id="chart" width="400" height="200"></canvas>

    <button class="floating-btn" onclick="scrollToTop()">Topo</button>

    <script>
        const descriptionInput = document.getElementById('description');
        const amountInput = document.getElementById('amount');
        const categoryInput = document.getElementById('category');
        const expenseTable = document.querySelector('#expense-table tbody');
        const totalDisplay = document.getElementById('total-display');
        const goalDisplay = document.getElementById('goal-display');
        const monthlySummary = document.getElementById('monthly-summary');
        const goalInput = document.getElementById('goal');
        const incomeInput = document.getElementById('income');

        let total = 0;
        let goal = 0;
        let income = 0;

        const chartCanvas = document.getElementById('chart').getContext('2d');
        const chartData = {
            labels: ['Compras para casa', 'Cosméticos', '"Pizza, lanches, doces"', 'Contas', 'Outros'],
            datasets: [{
                label: 'Gastos por Categoria',
                data: [0, 0, 0, 0, 0],
                backgroundColor: ['#f87171', '#facc15', '#34d399', '#60a5fa', '#a78bfa']
            }]
        };
        const chart = new Chart(chartCanvas, {
            type: 'bar',
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false }
                }
            }
        });

        function updateChart(category, amount) {
            const index = chartData.labels.indexOf(category);
            if (index !== -1) {
                chartData.datasets[0].data[index] += amount;
                chart.update();
            }
        }

        function updateTotal() {
            totalDisplay.textContent = `Total de Gastos: R$ ${total.toFixed(2)}`;
            const saving = income - total;
            goalDisplay.textContent = `Meta: R$ ${goal.toFixed(2)} | Ganhos: R$ ${income.toFixed(2)} | Poupança Esperada: R$ ${saving.toFixed(2)}`;
            monthlySummary.textContent = `Gastos Mensais: R$ ${total.toFixed(2)} | Poupança: R$ ${saving.toFixed(2)} | Meta: R$ ${goal.toFixed(2)}`;
        }

        function updateMeta() {
            goal = parseFloat(goalInput.value) || 0;
            income = parseFloat(incomeInput.value) || 0;
            updateTotal();
        }

        function removeExpense(amount, row, category) {
            total -= amount;
            updateChart(category, -amount);
            updateTotal();
            expenseTable.removeChild(row);
            saveData();
        }

        function addExpense() {
            const description = descriptionInput.value.trim();
            const amount = parseFloat(amountInput.value);
            const category = categoryInput.value;
            if (!description || isNaN(amount)) return;

            const row = document.createElement('tr');
            row.innerHTML = `
        <td>${description}</td>
        <td>R$ ${amount.toFixed(2)}</td>
        <td>${category}</td>
        <td><button class="remove-btn" onclick="removeExpense(${amount}, this.closest('tr'), '${category}')">Remover</button></td>
      `;
            expenseTable.appendChild(row);

            total += amount;
            updateChart(category, amount);
            updateTotal();
            saveData();

            descriptionInput.value = '';
            amountInput.value = '';
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveData() {
            localStorage.setItem('expenses', expenseTable.innerHTML);
            localStorage.setItem('total', total);
        }

        window.onload = () => {
            expenseTable.innerHTML = localStorage.getItem('expenses') || '';
            total = parseFloat(localStorage.getItem('total')) || 0;
            updateTotal();
        }

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(() => console.log('Service Worker registrado'))
                .catch(error => console.error('Erro ao registrar o Service Worker:', error));
        }
    </script>
</body>

</html>